// Code generated by protoc-gen-go-cel-validate. DO NOT EDIT.
// versions:
//  protoc-gen-go-cel-validate	{{PluginVersion}}
//  protoc						{{ProtocVersion}}
// source: {{.Desc.Path}}

package {{.GoPackageName}}

{{$file := .}}

var _{{.GoDescriptorIdent.GoName}}_rawValidateOptions = []byte{
    {{ range $value := (protoMarshal .Config) -}}
    {{ printf "0x%02x, " $value}}
    {{- end }}
}

{{range $messageNo,$m := .Messages}}
{{$buildValidate := false}}
{{range $fieldNo, $f := $m.Fields }}
	{{if or $f.FieldRule $f.HasResourceReference $f.HasFieldBehaviorRequired}}
		{{$buildValidate = true}}
	{{end}}
{{end}}
{{if $buildValidate}}
var (
    _{{$.GoDescriptorIdent.GoName}}_{{$m.GoIdent.GoName}}_celValidateMap map[string]{{cel "Program"}} = nil
	_{{$.GoDescriptorIdent.GoName}}_{{$m.GoIdent.GoName}}_celValidateMapOnce {{sync "Once"}}
)

func (m *{{$m.GoIdent.GoName}}) Validate(ctx {{context "Context"}}) error {
    return m.ValidateWithMask(ctx, &{{fieldmaskpb "FieldMask"}}{
        Paths: []string{"*"},
    })
}

func (m *{{$m.GoIdent.GoName}}) ValidateWithMask(ctx {{context "Context"}}, fm *{{fieldmaskpb "FieldMask"}}) error {
    _{{$.GoDescriptorIdent.GoName}}_{{$m.GoIdent.GoName}}_celValidateMapOnce.Do(func() {
        cfg := &{{validate "ValidateOptions"}}{}
        if err := {{proto "Unmarshal"}}(_{{$file.GoDescriptorIdent.GoName}}_rawValidateOptions,cfg); err != nil {
            return
        }
        tmp := map[string]{{cel "Program"}}{}
        for k, v := range map[string]struct{
            expr string
            req {{proto "Message"}}
        }{
            {{range $f := $m.Fields -}}
            {{- if $f.FieldRule -}}
            "{{$f.Desc.TextName}}": {expr: `{{$f.FieldRule.Expr}}`, req: m},
            {{- else if $f.HasResourceReference -}}
            "{{$f.Desc.TextName}}": {expr: `{{$f.GetResourceReferenceValidate}}`, req: m},
            {{- end}}
            {{end}}
        }{
            if pgr, err := {{validate "BuildValidateProgram"}}(v.expr, v.req, cfg); err != nil {
                return
            } else {
                tmp[k] = pgr
            }
        }
        _{{$.GoDescriptorIdent.GoName}}_{{$m.GoIdent.GoName}}_celValidateMap = tmp
    })
    return {{validate "ValidateWithMask"}}(ctx, m, fm, _{{$.GoDescriptorIdent.GoName}}_{{$m.GoIdent.GoName}}_celValidateMap)
}
{{else}}
func (m *{{$m.GoIdent.GoName}}) Validate(ctx {{context "Context"}}) error {
	return nil
}

func (m *{{$m.GoIdent.GoName}}) ValidateWithMask(ctx {{context "Context"}}, fm *{{fieldmaskpb "FieldMask"}}) error {
    return nil
}
{{end}}
{{end}}